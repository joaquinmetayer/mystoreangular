"use strict";(self.webpackChunkjoaquinmetayer=self.webpackChunkjoaquinmetayer||[]).push([[710],{4710:(W,v,r)=>{r.r(v),r.d(v,{CheckoutModule:()=>u});var p=r(6895),f=r(3060),l=r(8505),T=r(3900),O=r(4986),S=r(7272),y=r(5698),x=r(4482),D=r(5403),F=r(5032),U=r(9718),k=r(5577),b=r(8421);function M(o,e){return e?n=>(0,S.z)(e.pipe((0,y.q)(1),function J(){return(0,x.e)((o,e)=>{o.subscribe((0,D.x)(e,F.Z))})}()),n.pipe(M(o))):(0,k.z)((n,i)=>(0,b.Xf)(o(n,i)).pipe((0,y.q)(1),(0,U.h)(n)))}var P=r(5963),t=r(4650),N=r(529);class d{constructor(e){this.http=e,this.apiURL="http://localhost:3000"}getStores(){return this.http.get(`${this.apiURL}/stores`)}saveOrder(e){return this.http.post(`${this.apiURL}/orders`,e)}saveDetailsOrder(e){return this.http.post(`${this.apiURL}/detailsOrders`,e)}}d.\u0275fac=function(e){return new(e||d)(t.LFG(N.eN))},d.\u0275prov=t.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"});var Z=r(1632),Q=r(3354),c=r(4006),$=r(4859),C=r(7676),A=r(1948),Y=r(4144),E=r(1259),L=r(3238);function z(o,e){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"currency"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA()()),2&o){const n=e.$implicit;t.xp6(2),t.Oqu(n.name),t.xp6(2),t.Oqu(n.qty),t.xp6(2),t.Oqu(t.lcZ(7,4,n.price)),t.xp6(3),t.hij("$",n.price*n.qty,"")}}class m{constructor(e){this.shoppingCartSvc=e,this.total$=this.shoppingCartSvc.totalAction$,this.cart$=this.shoppingCartSvc.cartAction$}ngOnInit(){}}function q(o,e){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Name is required "),t.qZA())}function j(o,e){if(1&o){const n=t.EpF();t.ynx(0),t.TgZ(1,"mat-form-field",3)(2,"input",13,14),t.NdJ("ngModelChange",function(a){t.CHM(n);const s=t.oxw();return t.KtG(s.model.shippingAddress=a)}),t.qZA()(),t.TgZ(4,"mat-form-field",3)(5,"input",15,16),t.NdJ("ngModelChange",function(a){t.CHM(n);const s=t.oxw();return t.KtG(s.model.city=a)}),t.qZA()(),t.BQk()}if(2&o){const n=t.oxw();t.xp6(2),t.Q6J("ngModel",n.model.shippingAddress),t.xp6(3),t.Q6J("ngModel",n.model.city)}}function H(o,e){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const n=e.$implicit;t.Q6J("value",n),t.xp6(1),t.AsE(" ",n.name," - ",n.openingHours," ")}}function G(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"mat-form-field",3)(1,"mat-label"),t._uU(2,"Select me"),t.qZA(),t.TgZ(3,"mat-select",17,18),t.NdJ("ngModelChange",function(a){t.CHM(n);const s=t.oxw();return t.KtG(s.model.store=a)}),t.YNc(5,H,2,3,"mat-option",19),t.qZA()()}if(2&o){const n=t.oxw();t.xp6(3),t.Q6J("ngModel",n.model.store),t.xp6(2),t.Q6J("ngForOf",n.stores)}}m.\u0275fac=function(e){return new(e||m)(t.Y36(Z.F))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-details"]],decls:19,vars:8,consts:[[1,"container"],[1,"table"],[4,"ngFor","ngForOf"],[1,"total"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"table",1)(2,"thead")(3,"tr")(4,"th"),t._uU(5,"Item"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"Qty"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Price unit"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Sub total"),t.qZA()()(),t.TgZ(12,"tbody"),t.YNc(13,z,10,6,"tr",2),t.ALo(14,"async"),t.qZA()(),t.TgZ(15,"p",3),t._uU(16),t.ALo(17,"currency"),t.ALo(18,"async"),t.qZA()()),2&e&&(t.xp6(13),t.Q6J("ngForOf",t.lcZ(14,2,n.cart$)),t.xp6(3),t.hij("Total: ",t.lcZ(17,4,t.lcZ(18,6,n.total$)),""))},dependencies:[p.sg,p.Ov,p.H9],styles:[".container[_ngcontent-%COMP%]{margin:2rem auto;width:90%;overflow:scroll}table[_ngcontent-%COMP%]{font-size:1.2rem;line-height:1.2;width:100%}th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:1rem;text-align:left}td[_ngcontent-%COMP%]{background-color:#eee;padding:1rem}.total[_ngcontent-%COMP%]{color:#000;font-size:1.5rem;font-weight:700;line-height:1.2;margin:1rem 0 0;padding:1rem}"]});class h{constructor(e,n,i,a){this.dataSvc=e,this.shoppingCartSvc=n,this.router=i,this.productsSvc=a,this.model={name:"Joaquin Metayer",store:"",shippingAddress:"",city:""},this.isDelivery=!0,this.cart=[],this.stores=[],this.checkIfCartIsEmpty()}ngOnInit(){this.getStores(),this.getDataCart(),this.prepareDetails()}onPickupOrDelivery(e){this.isDelivery=e}onSubmit({value:e}){console.log("Guardar",e);const n={...e,date:this.getCurrentDay(),isDelivery:this.isDelivery};this.dataSvc.saveOrder(n).pipe((0,l.b)(i=>console.log("Order ->",i)),(0,T.w)(({id:i})=>{const a=this.prepareDetails();return this.dataSvc.saveDetailsOrder({details:a,orderId:i})}),(0,l.b)(()=>this.router.navigate(["/checkout/thank-you-page"])),function I(o,e=O.z){const n=(0,P.H)(o,e);return M(()=>n)}(2e3),(0,l.b)(()=>this.shoppingCartSvc.resetCart())).subscribe()}getStores(){this.dataSvc.getStores().pipe((0,l.b)(e=>this.stores=e)).subscribe()}getCurrentDay(){return(new Date).toLocaleDateString()}prepareDetails(){const e=[];return this.cart.forEach(n=>{const{id:i,name:a,qty:s,stock:K}=n;this.productsSvc.updateStock(i,K-s).pipe((0,l.b)(()=>e.push({productId:i,productName:a,quantity:s}))).subscribe()}),e}getDataCart(){this.shoppingCartSvc.cartAction$.pipe((0,l.b)(e=>this.cart=e)).subscribe()}checkIfCartIsEmpty(){this.shoppingCartSvc.cartAction$.pipe((0,l.b)(e=>{Array.isArray(e)&&!e.length&&this.router.navigate(["/products"])})).subscribe()}}h.\u0275fac=function(e){return new(e||h)(t.Y36(d),t.Y36(Z.F),t.Y36(f.F0),t.Y36(Q.s))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-checkout"]],decls:21,vars:5,consts:[[1,"container"],[1,"form"],["checkoutForm","ngForm"],[1,"form__element"],["matInput","","placeholder","Name","required","","name","name",3,"ngModel","ngModelChange"],["name","ngModel"],[4,"ngIf"],["value","pickup",3,"change"],["value","delivery","checked","",3,"change"],[4,"ngIf","ngIfElse"],["showStores",""],[1,"actions"],["color","primary","mat-raised-button","","type","submit",1,"actions__btn",3,"disabled","click"],["matInput","","placeholder","Shipping Address","name","shippingAddress",3,"ngModel","ngModelChange"],["shippingAddress","ngModel"],["matInput","","placeholder","City","name","city",3,"ngModel","ngModelChange"],["city","ngModel"],["name","store",3,"ngModel","ngModelChange"],["store","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,n){if(1&e){const i=t.EpF();t.TgZ(0,"div",0)(1,"form",1,2)(3,"mat-form-field",3)(4,"input",4,5),t.NdJ("ngModelChange",function(s){return n.model.name=s}),t.qZA(),t.YNc(6,q,2,0,"mat-error",6),t.qZA(),t.TgZ(7,"mat-radio-group",3)(8,"p"),t._uU(9,"Choose an option:"),t.qZA(),t.TgZ(10,"mat-radio-button",7),t.NdJ("change",function(){return n.onPickupOrDelivery(!1)}),t._uU(11,"Pickup"),t.qZA(),t.TgZ(12,"mat-radio-button",8),t.NdJ("change",function(){return n.onPickupOrDelivery(!0)}),t._uU(13," Delivery "),t.qZA()(),t.YNc(14,j,7,2,"ng-container",9),t.YNc(15,G,6,2,"ng-template",null,10,t.W1O),t.qZA()(),t._UZ(17,"app-details"),t.TgZ(18,"div",11)(19,"button",12),t.NdJ("click",function(){t.CHM(i);const s=t.MAs(2);return t.KtG(n.onSubmit(s))}),t._uU(20," Checkout "),t.qZA()()}if(2&e){const i=t.MAs(2),a=t.MAs(5),s=t.MAs(16);t.xp6(4),t.Q6J("ngModel",n.model.name),t.xp6(2),t.Q6J("ngIf",!a.valid||a.pristine),t.xp6(8),t.Q6J("ngIf",n.isDelivery)("ngIfElse",s),t.xp6(5),t.Q6J("disabled",!i.form.valid)}},dependencies:[p.sg,p.O5,c._Y,c.Fj,c.JJ,c.JL,c.Q7,c.On,c.F,$.lW,C.KE,C.hX,C.TO,A.VQ,A.U0,Y.Nt,E.gD,L.ey,m],styles:[".container[_ngcontent-%COMP%]{margin:6rem auto 0;width:90%}.form__element[_ngcontent-%COMP%]{width:100%}.form[_ngcontent-%COMP%]   .mat-radio-group[_ngcontent-%COMP%]{display:block}.form[_ngcontent-%COMP%]   .mat-radio-button[_ngcontent-%COMP%]{margin-right:1rem}.actions[_ngcontent-%COMP%]{margin:4rem auto 0;width:40%}.actions__btn[_ngcontent-%COMP%]{width:100%}"]});const R=[{path:"",component:h},{path:"thank-you-page",loadChildren:()=>r.e(391).then(r.bind(r,9391)).then(o=>o.ThankYouPageModule)}];class g{}g.\u0275fac=function(e){return new(e||g)},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({imports:[f.Bz.forChild(R),f.Bz]});var B=r(3806);class u{}u.\u0275fac=function(e){return new(e||u)},u.\u0275mod=t.oAB({type:u}),u.\u0275inj=t.cJS({imports:[p.ez,g,c.u5,B.q]})}}]);